<!DOCTYPE html>
<html>
<head>
    <title>Casinova Controller</title>
    <link rel="stylesheet" href="/style.css">
    <script src="/script.js" defer></script>
</head>
<body>
    <h1>Casinova Control Panel</h1>

    <div class="section">
        <h2>Card Capture</h2>
        <button onclick="capture()">Capture</button><br><br>
        <img id="snapshot" width="320" height="240"/>
    </div>

    <div class="section">
        <h2>Ejection Motor</h2>
        <input id="distanceInput" type="number" placeholder="Distance (mm)" value="750" />
        <button onclick="eject()">Eject</button>
    </div>

    <div class="section">
        <h2>Swivel Motor</h2>
        <input id="angleInput" type="number" placeholder="Degrees" value="90" />
        <button onclick="rotate()">Rotate</button>
    </div>
    <div id="game-controls">
        <h2>Game Control</h2>
        <button onclick="advanceGame()">Next Phase</button>
        <p id="phase-status">Waiting for players...</p>
      </div>
      
      <script>
        function advanceGame() {
          fetch('/nextPhase')
            .then(res => res.text())
            .then(msg => {
              document.getElementById('phase-status').innerText = msg;
            })
            .catch(err => {
              console.error('Failed to advance phase:', err);
              alert("Error advancing phase.");
            });
        }
      </script>

    <div id="community">
        <h2>Community Cards</h2>
        <div id="cards"></div>
    </div>

    <script>
        function fetchGamestate() {
          fetch('/gamestate')
            .then(res => res.json())
            .then(data => {
              const cardsDiv = document.getElementById('cards');
              cardsDiv.innerHTML = "";  // clear previous cards
              data.community.forEach(card => {
                const span = document.createElement("span");
                span.textContent = card + " ";
                span.style.marginRight = "10px";
                cardsDiv.appendChild(span);
              });
            });
        }
        
        // Poll every 2 seconds
        setInterval(fetchGamestate, 2000);
        </script>
      
</body>
</html>
